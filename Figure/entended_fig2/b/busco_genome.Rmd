```{r cars}
######################################
#
# BUSCO summary figure
# @version 4.0.0
# @since BUSCO 2.0.0
# 
# Copyright (c) 2016-2017, Evgeny Zdobnov (ez@ezlab.org)
# Licensed under the MIT license. See LICENSE.md file.
#
######################################

# Load the required libraries
library(ggplot2)
library("grid")

# !!! CONFIGURE YOUR PLOT HERE !!! 
# Output
my_output <- "./d_assembly_busco.pdf"
my_width <- 20
my_height <- 20
my_unit <- "cm"

# Colors
my_colors <- rev(c("#56B4E9", "#3492C7", "#F0E442", "#F04442"))
# Bar height ratio
my_bar_height <- 0.75

# Legend
my_title <- "BUSCO Assessment Results"

order <- read.table("busco-assembly.order",header=F)
my_order <- rev(order$V1)
#my_order# Font
my_size_ratio <- 0.8

# !!! SEE YOUR DATA HERE !!! 
# Your data as generated by python, remove or add more
my_species <- c('EA00371', 'EA00371', 'EA00371', 'EA00371', 'BGV007931', 'BGV007931', 'BGV007931', 'BGV007931', 'TS171', 'TS171', 'TS171', 'TS171', 'EA00990', 'EA00990', 'EA00990', 'EA00990', 'TS545', 'TS545', 'TS545', 'TS545', 'TS238', 'TS238', 'TS238', 'TS238', 'BGV007989', 'BGV007989', 'BGV007989', 'BGV007989', 'BGV006775', 'BGV006775', 'BGV006775', 'BGV006775', 'LA2093', 'LA2093', 'LA2093', 'LA2093', 'TS112', 'TS112', 'TS112', 'TS112', 'TS117', 'TS117', 'TS117', 'TS117', 'TS12', 'TS12', 'TS12', 'TS12', 'TS80', 'TS80', 'TS80', 'TS80', 'TS9', 'TS9', 'TS9', 'TS9', 'BGV006865', 'BGV006865', 'BGV006865', 'BGV006865', 'TS15', 'TS15', 'TS15', 'TS15', 'SL4.0', 'SL4.0', 'SL4.0', 'SL4.0', 'TS3', 'TS3', 'TS3', 'TS3', 'TS60', 'TS60', 'TS60', 'TS60', 'LYC1410', 'LYC1410', 'LYC1410', 'LYC1410', 'PP', 'PP', 'PP', 'PP', 'TS118', 'TS118', 'TS118', 'TS118', 'TS331', 'TS331', 'TS331', 'TS331', 'TS166', 'TS166', 'TS166', 'TS166', 'TS185', 'TS185', 'TS185', 'TS185', 'TS439', 'TS439', 'TS439', 'TS439', 'TS413', 'TS413', 'TS413', 'TS413', 'TS280', 'TS280', 'TS280', 'TS280', 'TS421', 'TS421', 'TS421', 'TS421', 'TS623', 'TS623', 'TS623', 'TS623', 'TS265', 'TS265', 'TS265', 'TS265', 'TS156', 'TS156', 'TS156', 'TS156', 'TS39', 'TS39', 'TS39', 'TS39', 'PI169588', 'PI169588', 'PI169588', 'PI169588', 'TS629', 'TS629', 'TS629', 'TS629', 'PAS014479', 'PAS014479', 'PAS014479', 'PAS014479', 'Brandywine', 'Brandywine', 'Brandywine', 'Brandywine', 'SL5.0', 'SL5.0', 'SL5.0', 'SL5.0', 'TS204', 'TS204', 'TS204', 'TS204', 'Fla8924', 'Fla8924', 'Fla8924', 'Fla8924', 'Floradade', 'Floradade', 'Floradade', 'Floradade', 'TS281', 'TS281', 'TS281', 'TS281', 'MM', 'MM', 'MM', 'MM', 'TS222', 'TS222', 'TS222', 'TS222', 'TS692', 'TS692', 'TS692', 'TS692', 'PI303721', 'PI303721', 'PI303721', 'PI303721', 'TS96', 'TS96', 'TS96', 'TS96')
my_species <- factor(my_species)
my_species <- factor(my_species,levels = my_order) # reorder your species here just by changing the values in the vector :
my_percentage <- c(96.3, 1.3, 0.3, 2.1, 96.1, 1.4, 0.3, 2.2, 96.3, 1.4, 0.3, 2.0, 96.3, 1.4, 0.3, 2.0, 95.7, 1.4, 0.3, 2.6, 96.1, 1.4, 0.3, 2.2, 96.2, 1.4, 0.3, 2.1, 96.2, 1.4, 0.3, 2.1, 96.4, 1.3, 0.3, 2.0, 95.7, 1.5, 0.3, 2.5, 96.2, 1.3, 0.2, 2.3, 96.1, 1.5, 0.3, 2.1, 96.3, 1.4, 0.3, 2.0, 95.7, 1.5, 0.3, 2.5, 96.4, 1.3, 0.2, 2.1, 95.9, 1.4, 0.3, 2.4, 95.7, 1.4, 0.5, 2.4, 96.3, 1.4, 0.3, 2.0, 96.2, 1.4, 0.3, 2.1, 96.3, 1.4, 0.3, 2.0, 96.3, 1.2, 0.3, 2.2, 96.3, 1.4, 0.3, 2.0, 96.1, 1.5, 0.3, 2.1, 96.2, 1.4, 0.3, 2.1, 95.8, 1.4, 0.3, 2.5, 96.3, 1.4, 0.2, 2.1, 96.1, 1.5, 0.3, 2.1, 96.3, 1.4, 0.3, 2.0, 96.3, 1.4, 0.3, 2.0, 96.1, 1.4, 0.3, 2.2, 96.0, 1.4, 0.3, 2.3, 96.0, 1.5, 0.3, 2.2, 96.1, 1.5, 0.3, 2.1, 96.3, 1.4, 0.3, 2.0, 96.0, 1.4, 0.4, 2.2, 96.1, 1.4, 0.3, 2.2, 96.3, 1.4, 0.3, 2.0, 96.3, 1.3, 0.3, 2.1, 96.2, 1.5, 0.3, 2.0, 96.3, 1.4, 0.3, 2.0, 96.2, 1.4, 0.3, 2.1, 96.2, 1.4, 0.3, 2.1, 95.7, 1.5, 0.3, 2.5, 96.3, 1.4, 0.3, 2.0, 96.2, 1.4, 0.3, 2.1, 96.3, 1.5, 0.3, 1.9, 96.3, 1.3, 0.3, 2.1)
my_values <- c(5730, 80, 15, 125, 5719, 85, 18, 128, 5727, 85, 16, 122, 5729, 82, 15, 124, 5692, 84, 18, 156, 5715, 84, 20, 131, 5725, 81, 18, 126, 5723, 83, 19, 125, 5737, 78, 15, 120, 5692, 87, 18, 153, 5726, 79, 14, 131, 5716, 92, 16, 126, 5729, 81, 17, 123, 5697, 87, 17, 149, 5734, 76, 14, 126, 5706, 83, 15, 146, 5697, 85, 27, 141, 5727, 82, 17, 124, 5722, 84, 18, 126, 5730, 82, 16, 122, 5729, 74, 19, 128, 5730, 81, 16, 123, 5720, 88, 17, 125, 5721, 86, 18, 125, 5699, 85, 18, 148, 5728, 83, 14, 125, 5718, 89, 18, 125, 5727, 81, 20, 122, 5731, 82, 16, 121, 5718, 86, 17, 129, 5713, 84, 16, 137, 5712, 88, 17, 133, 5716, 87, 18, 129, 5731, 81, 15, 123, 5711, 84, 21, 134, 5717, 84, 17, 132, 5729, 82, 16, 123, 5731, 79, 15, 125, 5725, 88, 16, 121, 5727, 83, 18, 122, 5724, 84, 16, 126, 5721, 85, 18, 126, 5697, 88, 17, 148, 5730, 83, 18, 119, 5726, 82, 18, 124, 5727, 88, 15, 120, 5729, 80, 17, 124)

######################################
######################################
######################################
# Code to produce the graph
labsize = 1
if (length(levels(my_species)) > 10){
 labsize = 0.66
}
print("Plotting the figure ...")
category <- c(rep(c("S","D","F","M"),c(1)))
category <-factor(category)
category = factor(category,levels(category)[c(3,2,1,4)])
df = data.frame(my_species,my_percentage,my_values,category)

figure <- ggplot() + 
  
  geom_bar(aes(y = my_percentage, x = my_species, fill = category), data = df, stat="identity", width=my_bar_height) + 
  coord_flip() + 
  theme_gray(base_size = 8) + 
  scale_y_continuous(expand=c(0,0),labels = c("0","20","40","60","80","100"), breaks = c(0,20,40,60,80,100)) + 
  scale_fill_manual(values = my_colors,labels =rev(c(" Complete (C) and single-copy (S)  ",
                                                 " Complete (C) and duplicated (D)",
                                                 " Fragmented (F)  ",
                                                 " Missing (M)"))) +   
  labs(x="",y="",title="") + 
  theme(plot.title = element_text(colour = "black", size = rel(2.2)*my_size_ratio, face = "bold")) + 
  theme(legend.position="bottom",legend.title = element_blank()) + 
  theme(legend.text = element_text(size = rel(1.2)*my_size_ratio)) + 
  theme(panel.background = element_rect(color="#FFFFFF", fill="white")) + 
  theme(panel.grid.minor = element_blank()) + 
  theme(panel.grid.major = element_blank()) +
  theme(axis.text.y = element_text(colour = "black", size = rel(1.66)*my_size_ratio)) + 
  theme(axis.text.x = element_blank()) + 
  theme(axis.line = element_blank()) + 
  theme(axis.ticks = element_blank()) + 
  
  guides(fill = guide_legend(override.aes = list(colour = NULL))) +
  guides(fill=guide_legend(nrow=2,byrow=TRUE,reverse=TRUE))
  
  for(i in rev(c(1:length(levels(my_species))))){
    detailed_values <- my_values[my_species==my_species[my_species==levels(my_species)[i]]]
    percent_values <- my_percentage[my_species==my_species[my_species==levels(my_species)[i]]]
    total_buscos <- sum(detailed_values)
    figure <- figure + 
    annotate("text", label=paste("C:", percent_values[1] + percent_values[2], "% [S:", percent_values[1],"%, D:", percent_values[2], "%], F:", percent_values[3], "%, M:", percent_values[4], "%, n:", total_buscos,sep=""), 
             y=3, x = i, size = labsize*4*my_size_ratio, colour = "black", hjust=0)
  }
  
ggsave(figure, file=my_output, width = my_width, height = my_height, unit = my_unit)
```
